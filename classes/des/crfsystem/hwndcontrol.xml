<form name="HWNDControl" caption="Control" savepos="UPMHWNDControl" hidden="1" esccancel="1" fauthor="$Author: Chris Moran $" fdate="$Date: 8 12 03 11:37 $" frevision="$Revision: 1 $">
<members>
<Integer name="bDone" />
<String name="szAnswer" />
<Integer name="WindowCount" />
<method name="OnWMCopyData">
<param name="data" type="object" />
<param name="val" type="object" />
<![CDATA[//@cmember OnWMCopyData
//@param object | cmd |
//@param object | val |
//@version Jonny Moo | 06-02-03 11:39 |
// extract the data

if(val==0)
{
    WindowCount--;
    if(WindowCount==0)
    {
        close();
    }
}
else
{

    bDone = 1;
    szAnswer = data;
}]]>
</method>
<method name="OnClose">
<param name="ctrl" type="label" />
<![CDATA[//@cmember OnClose
//@param label | ctrl |
//@version Jonny Moo | 03-02-03 15:28 |
//@i

Close();]]>
</method>
</members>
<static>
<method name="GetHWNDID" return="string">
<param name="par" type="object" />
<param name="Application" type="string" />
<param name="Command" type="string" />
<param name="bHide" type="object" />
<![CDATA[//@cmember GetHWNDID
//@param object | par |
//@param string | Application |
//@param string | Command | A string to ask the window if this is the correct one or not
//@param object | bHide |
//@return string | The Return String or #WINDOWNOTFOUND or #CANCELLED
//@version Jonny Moo | 06-02-03 09:10 |
//@version Chris.Moran | 12-02-03 14:37 |
//@version Jonathan.Muir | 14-08-03 11:33 |
//@i

// The application is found because the window has a property of (application) with a setting 5566

classes::Des::CRFSystem::HWNDControl ControlWindow;

string wnm = ControlWindow.ClassName();

ControlWindow.SetWindowName(wnm);

ControlWindow.Dialog(par);
ControlWindow.SizeFormToContent();

int MyHandle = ControlWindow.GetHWND();

// Find application

int bApplicationFound = 0;

ControlWindow.idProgress.SetText("Finding Window");

//if(bHide==NULL||bHide==0) ControlWindow.Show(1);

int h = 0;

for(int n=0;;n++)
{
    // get next
    h = Sys::HWNDFindEx(0,h,"WFL32WNDCLASS","");
    if (!h) break;
    // send message
    int i = Sys::HWNDGetProp(h,application);
    if (i==5566)
    {
        // Send the command
        ControlWindow.WindowCount++;
        sys::HWNDSendIPC(h,MyHandle,"GetHWND,"+command);
    }
}

if(ControlWindow.WindowCount==0)
{
    ControlWindow.Close();
    return "#WINDOWNOTFOUND";
}

// Wait for an answer

ControlWindow.idProgress.SetText("Waiting for reply");

while(1)
{

    sys::wait(100);

    object TheForm = par.GetPopup(wnm);
    if(TheForm == NULL) return "#CANCELLED";

    if(TheForm.bDone)
    {
        TheForm.Close();
        return TheForm.szAnswer;
    }
}]]>
</method>
<method name="DoIPCCommand" return="string">
<param name="par" type="object" />
<param name="HWNDID" type="object" />
<param name="szCommand" type="object" />
<![CDATA[//@cmember DoIPCCommand
//@param object | par |
//@param object | HWNDID |
//@param object | szCommand |
//@return string | The Return String or #WINDOWNOTFOUND or #CANCELLED
//@version Jonny Moo | 06-02-03 11:20 |
//@version Chris.Moran | 12-02-03 14:35 |
//@version Jonny Moo | 13-06-03 16:50 |
//@version Jonathan.Muir | 14-08-03 11:34 |
//@i

// The application is found because the window has a property of (application) with a setting 5566

classes::DES::CRFSystem::HWNDControl ControlWindow;

string wnm = ControlWindow.ClassName();

ControlWindow.SetWindowName(wnm);

ControlWindow.Dialog(par);
ControlWindow.SizeFormToContent();
//ControlWindow.Show(1);

int MyHandle = ControlWindow.GetHWND();

// Send the command
ControlWindow.WindowCount++;
sys::HWNDSendIPC(HWNDID,MyHandle,szCommand);

// Wait for an answer

ControlWindow.idProgress.SetText("Waiting for reply");

while(1)
{

    sys::wait(100);



    object TheForm = par.GetPopup(wnm);

    if(TheForm == NULL) return "#CANCELLED";

    if(TheForm.bDone)
    {
        TheForm.Close();
        return TheForm.szAnswer;
    }
}]]>
</method>
</static>
<grid>
<row>
<col />
<col w="200" />
<col />
</row>
<row>
<col />
<col lpad="4" tpad="4" rpad="4" bpad="12" align="C" bk="0,128,128">
<Label name="idWait" text="Getting Application Info.." tx="255,255,255" size="12" style="b" />
</col>
<col />
</row>
<row>
<col />
<col />
<col />
</row>
<row>
<col />
<col tpad="8" bpad="8">
<Label name="idProgress" text="Progress" hide="Y" />
</col>
<col />
</row>
<row>
<col />
<col h="8" />
<col />
</row>
<row>
<col />
<col align="RV" imgtile="32">
<grid>
<row>
<col lpad="12" tpad="3" rpad="12" bpad="6" align="CV" bkimg="classes::resource::standard::button.bmp" imgtile="32">
<Label name="idCancel" text="Cancel" tx="255,255,255" txsel="FFFF00" style="b" onClick="OnClose" hide="Y" />
</col>
</row>
</grid>
</col>
<col />
</row>
<row>
<col />
<col />
<col />
</row>
</grid>
<return>
<rmeth name="GetHWNDID" cls="string" />
<rmeth name="DoIPCCommand" cls="string" />
</return>
</form>
